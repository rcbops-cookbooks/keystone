# This file autogenerated by Chef
# Do not edit, changes will be overwritten

WSGIDaemonProcess keystone user=keystone group=keystone processes=3 threads=10
<%if @service_ip == @internal_ip and @service_port == @internal_port %>
    
    <%# IP and port are equal than if either is set for SSL we will setup both to be SSL %>
    <% if [@service_scheme, @internal_scheme].any? {|scheme| scheme == "https"} %>
Listen <%= @service_ip %>:<%= @service_port %>
<VirtualHost <%= @service_ip %>:<%= @service_port %>>
LogLevel warn
ErrorLog /var/log/keystone/service_error.log
CustomLog /var/log/keystone/service_ssl_access.log combined

SSLEngine on
SSLCertificateFile <%= @service_cert_file %>
SSLCertificateKeyFile <%= @service_key_file %>
<% unless @service_chain_file == "donotset" %>
SSLCertificateChainFile <%= @service_chain_file %>
<%end %>

SSLVerifyClient optional
SSLVerifyDepth 10
SSLProtocol all -SSLv2
SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
SSLOptions +StdEnvVars +ExportCertData

WSGIScriptAlias / <%= @service_wsgi_file %>
WSGIProcessGroup keystone
</VirtualHost>
    <%# Setup both internal and service for http %>
    
    <%else %>
Listen <%= @service_ip %>:<%= @service_port %>
<VirtualHost <%= @service_ip %>:<%= @service_port %>>
LogLevel warn
ErrorLog /var/log/keystone/service_error.log
CustomLog /var/log/keystone/service_ssl_access.log combined

WSGIScriptAlias / <%= @service_wsgi_file %>
WSGIProcessGroup keystone

</VirtualHost>
    <%end %>

<% else %>
<%#Setup service URI %>
Listen <%= @service_ip %>:<%= @service_port %>
<VirtualHost <%= @service_ip %>:<%= @service_port %>>
LogLevel warn
ErrorLog /var/log/keystone/service_error.log
CustomLog /var/log/keystone/service_ssl_access.log combined
<% if @service_scheme == "https" %>
SSLEngine on
SSLCertificateFile <%= @service_cert_file %>
SSLCertificateKeyFile <%= @service_key_file %>
<% unless @service_chain_file == "donotset" %>
SSLCertificateChainFile <%= @service_chain_file %>
<%end %>

SSLVerifyClient optional
SSLVerifyDepth 10
SSLProtocol all -SSLv2
SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
SSLOptions +StdEnvVars +ExportCertData       
<% end %>

WSGIScriptAlias / <%= @service_wsgi_file %>
WSGIProcessGroup keystone
</VirtualHost>
    <%# Setup internal URI %>
Listen <%= @internal_ip %>:<%= @internal_port %>
<VirtualHost <%= @internal_ip %>:<%= @internal_port %>>
LogLevel warn
ErrorLog /var/log/keystone/internal_error.log
CustomLog /var/log/keystone/internal_ssl_access.log combined
    <% if @internal_scheme == "https" %>
SSLEngine on
SSLCertificateFile <%= @internal_cert_file %>
SSLCertificateKeyFile <%= @internal_key_file %>
<% unless @internal_chain_file == "donotset" %>
SSLCertificateChainFile <%= @internal_chain_file %>
<%end %>

SSLVerifyClient optional
SSLVerifyDepth 10
SSLProtocol all -SSLv2
SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
SSLOptions +StdEnvVars +ExportCertData       
    <% end %>
    
WSGIScriptAlias / <%= @internal_wsgi_file %>
WSGIProcessGroup keystone
</VirtualHost>

<% end %>

Listen <%= @admin_ip %>:<%= @admin_port %>
<VirtualHost <%= @admin_ip %>:<%= @admin_port %>>
LogLevel warn
ErrorLog /var/log/keystone/admin_error.log
CustomLog /var/log/keystone/admin_ssl_access.log combined
<% if @admin_scheme == "https" %>
SSLEngine on
SSLCertificateFile <%= @admin_cert_file %>
SSLCertificateKeyFile <%= @admin_key_file %>
<% unless @admin_chain_file == "donotset" %>
SSLCertificateChainFile <%= @admin_chain_file %>
<%end %>

SSLVerifyClient optional
SSLVerifyDepth 10
SSLProtocol all -SSLv2
SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
SSLOptions +StdEnvVars +ExportCertData
<% end %>

WSGIScriptAlias / <%= @admin_wsgi_file %>
WSGIProcessGroup keystone

</VirtualHost>
